"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[8143],{3880:(e,n,d)=>{d.r(n),d.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>m,frontMatter:()=>t,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"reference/wasm/wasm-add-module","title":"Adding a new WASM module","description":"1. Create a new directory: src/wasm/modules//.","source":"@site/docs/reference/wasm/how-to-add-a-module.md","sourceDirName":"reference/wasm","slug":"/reference/wasm/wasm-add-module","permalink":"/Img2Num/info/docs/reference/wasm/wasm-add-module","draft":false,"unlisted":false,"editUrl":"https://github.com/Ryan-Millard/Img2Num/edit/main/docs/docs/reference/wasm/how-to-add-a-module.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"id":"wasm-add-module","title":"Adding a new WASM module","sidebar_position":6},"sidebar":"tutorialSidebar","previous":{"title":"Troubleshooting & size/ perf optimizations","permalink":"/Img2Num/info/docs/reference/wasm/wasm-troubleshooting"},"next":{"title":"Modules","permalink":"/Img2Num/info/docs/reference/wasm/modules"}}');var i=d(4848),o=d(8453);const t={id:"wasm-add-module",title:"Adding a new WASM module",sidebar_position:6},r="Step-by-step: add a new module",l={},a=[];function c(e){const n={code:"code",h1:"h1",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"step-by-step-add-a-new-module",children:"Step-by-step: add a new module"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Create a new directory: ",(0,i.jsx)(n.code,{children:"src/wasm/modules/<module-name>/"}),"."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Don't be daft - make sure to replace ",(0,i.jsx)(n.code,{children:"<module-name>"})," with the actual name your module should be given."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Add ",(0,i.jsx)(n.code,{children:"src/"}),", ",(0,i.jsx)(n.code,{children:"include/"})," and a ",(0,i.jsx)(n.code,{children:"Makefile"})," that obeys the root Makefile contract (targets: ",(0,i.jsx)(n.code,{children:"build"}),", ",(0,i.jsx)(n.code,{children:"debug"}),", ",(0,i.jsx)(n.code,{children:"clean"}),")."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Make sure the module's ",(0,i.jsx)(n.code,{children:"Makefile"})," writes output to ",(0,i.jsx)(n.code,{children:"build/"})," with ",(0,i.jsx)(n.code,{children:"index.js"})," and ",(0,i.jsx)(n.code,{children:"index.wasm"})," (the repo's alias generator expects ",(0,i.jsx)(n.code,{children:"modules/{name}/build"}),")."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"vite.config.js"})," will automatically find the module and create an alias ",(0,i.jsx)(n.code,{children:"@wasm-<module-name>"})," on next ",(0,i.jsx)(n.code,{children:"vite"})," start (or rebuild of the config). Example usage:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"import init from '@wasm-<module-name>/index.js';\nawait init();\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Commit the ",(0,i.jsx)(n.code,{children:"Makefile"})," and source files; do not commit ",(0,i.jsx)(n.code,{children:"build/"})," artifacts unless you want to vendor the WASM for static hosting without building."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h1,{id:"minimal-module-makefile-copypaste",children:"Minimal module Makefile (copy/paste)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-makefile",children:"EMCC ?= emcc\nSRC = $(wildcard src/*.cpp)\nOUT_DIR = build\n\n.PHONY: build debug clean\n\nbuild:\n\tmkdir -p $(OUT_DIR)\n\t$(EMCC) $(SRC) -o $(OUT_DIR)/index.js -O3 -s WASM=1 --bind\n\ndebug:\n\tmkdir -p $(OUT_DIR)\n\t$(EMCC) $(SRC) -o $(OUT_DIR)/index.js -g -O0 -s ASSERTIONS=1 --bind\n\nclean:\n\trm -rf $(OUT_DIR)\n"})})]})}function m(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,n,d)=>{d.d(n,{R:()=>t,x:()=>r});var s=d(6540);const i={},o=s.createContext(i);function t(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);