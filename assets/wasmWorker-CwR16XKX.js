(function(){"use strict";async function Te(c={}){var h,n=c,F=typeof window=="object",R=typeof WorkerGlobalScope<"u";typeof process=="object"&&process.versions?.node&&process.type!="renderer";var d=R&&self.name?.startsWith("em-pthread"),N="./this.program",k=(e,r)=>{throw r},V=self.location.href,H="";function Q(e){return n.locateFile?n.locateFile(e,H):H+e}var x,z;if(F||R){try{H=new URL(".",V).href}catch{}R&&(z=e=>{var r=new XMLHttpRequest;return r.open("GET",e,!1),r.responseType="arraybuffer",r.send(null),new Uint8Array(r.response)}),x=async e=>{var r=await fetch(e,{credentials:"same-origin"});if(r.ok)return r.arrayBuffer();throw new Error(r.status+" : "+r.url)}}var A=console.log.bind(console),m=console.error.bind(console),w,W,X=!1,B;function f(){M.buffer!=T.buffer&&Z()}var ie,Ae,Me;if(d){let e=function(r){try{var t=r.data,a=t.cmd;if(a==="load"){let s=[];self.onmessage=o=>s.push(o),Me=()=>{postMessage({cmd:"loaded"});for(let o of s)e(o);self.onmessage=e};for(const o of t.handlers)(!n[o]||n[o].proxy)&&(n[o]=(...i)=>{postMessage({cmd:"callHandler",handler:o,args:i})},o=="print"&&(A=n[o]),o=="printErr"&&(m=n[o]));M=t.wasmMemory,Z(),W=t.wasmModule,Se(),ne()}else if(a==="run"){Pr(t.pthread_ptr),be(t.pthread_ptr,0,0,1,0,0),u.threadInitTLS(),_e(t.pthread_ptr),se||(se=!0);try{Fr(t.start_routine,t.arg)}catch(s){if(s!="unwind")throw s}}else t.target==="setimmediate"||(a==="checkMailbox"?se&&ee():a&&(m(`worker: received unknown command ${a}`),m(t)))}catch(s){throw ir(),s}};var se=!1;self.onunhandledrejection=r=>{throw r.reason||r},self.onmessage=e}var M,T,C,oe,L,_,fe,K,E,Re=!1,le=!1;function Z(){var e=M.buffer;T=new Int8Array(e),oe=new Int16Array(e),n.HEAPU8=C=new Uint8Array(e),n.HEAP32=L=new Int32Array(e),_=new Uint32Array(e),fe=new Float32Array(e),K=new Float64Array(e),E=new BigInt64Array(e),new BigUint64Array(e)}function pr(){if(!d){if(n.wasmMemory)M=n.wasmMemory;else{var e=n.INITIAL_MEMORY||1073741824;M=new WebAssembly.Memory({initial:e/65536,maximum:32768,shared:!0})}Z()}}function gr(){if(n.preRun)for(typeof n.preRun=="function"&&(n.preRun=[n.preRun]);n.preRun.length;)He(n.preRun.shift());Fe(Ne)}function We(){if(Re=!0,d)return Me();U.u()}function yr(){d||(ar(),at(),u.terminateAllThreads(),le=!0)}function br(){if(!d){if(n.postRun)for(typeof n.postRun=="function"&&(n.postRun=[n.postRun]);n.postRun.length;)Sr(n.postRun.shift());Fe(Oe)}}function q(e){n.onAbort?.(e),e="Aborted("+e+")",m(e),X=!0,e+=". Build with -sASSERTIONS for more info.";var r=new WebAssembly.RuntimeError(e);throw Ae?.(r),r}var ue;function wr(){return n.locateFile?Q("index.wasm"):new URL("/Img2Num/assets/index-Do2f6jCb.wasm",self.location.href).href}function Tr(e){if(e==ue&&w)return new Uint8Array(w);if(z)return z(e);throw"both async and sync fetching of the wasm failed"}async function kr(e){if(!w)try{var r=await x(e);return new Uint8Array(r)}catch{}return Tr(e)}async function Ar(e,r){try{var t=await kr(e),a=await WebAssembly.instantiate(t,r);return a}catch(s){m(`failed to asynchronously prepare wasm: ${s}`),q(s)}}async function Mr(e,r,t){if(!e)try{var a=fetch(r,{credentials:"same-origin"}),s=await WebAssembly.instantiateStreaming(a,t);return s}catch(o){m(`wasm streaming compile failed: ${o}`),m("falling back to ArrayBuffer instantiation")}return Ar(r,t)}function Ee(){return vt(),{a:hr}}async function Se(){function e(i,l){return U=i.exports,Nr(U.E),Ve=U.v,W=l,ct(U),U}function r(i){return e(i.instance,i.module)}var t=Ee();if(n.instantiateWasm)return new Promise((i,l)=>{n.instantiateWasm(t,(v,g)=>{i(e(v,g))})});if(d){var a=new WebAssembly.Instance(W,Ee());return e(a,W)}ue??=wr();var s=await Mr(w,ue,t),o=r(s);return o}class Pe{name="ExitStatus";constructor(r){this.message=`Program terminated with exit(${r})`,this.status=r}}var Ue=e=>{e.terminate(),e.onmessage=r=>{}},Ie=e=>{var r=u.pthreads[e];u.returnWorkerToPool(r)},Fe=e=>{for(;e.length>0;)e.shift()(n)},Ne=[],He=e=>Ne.push(e),P=0,D=null,Rr=e=>{if(P--,n.monitorRunDependencies?.(P),P==0&&D){var r=D;D=null,r()}},Wr=e=>{P++,n.monitorRunDependencies?.(P)},Be=e=>{var r=u.getNewWorker();if(!r)return 6;u.runningWorkers.push(r),u.pthreads[e.pthread_ptr]=r,r.pthread_ptr=e.pthread_ptr;var t={cmd:"run",start_routine:e.startRoutine,arg:e.arg,pthread_ptr:e.pthread_ptr};return r.postMessage(t,e.transferList),0},ce=0,J=()=>me||ce>0,Ce=()=>dr(),ve=e=>cr(e),de=e=>vr(e),$=(e,r,t,...a)=>{for(var s=a.length*2,o=Ce(),i=de(s*8),l=i>>3,v=0;v<a.length;v++){var g=a[v];typeof g=="bigint"?((f(),E)[l+2*v]=1n,(f(),E)[l+2*v+1]=g):((f(),E)[l+2*v]=0n,(f(),K)[l+2*v+1]=g)}var b=or(e,r,s,i,t);return ve(o),b};function Le(e){if(d)return $(0,0,1,e);B=e,J()||(u.terminateAllThreads(),n.onExit?.(e),X=!0),k(e,new Pe(e))}function $e(e){if(d)return $(1,0,0,e);he(e)}var Er=(e,r)=>{if(B=e,d)throw $e(e),"unwind";J()||yr(),Le(e)},he=Er,u={unusedWorkers:[],runningWorkers:[],tlsInitFunctions:[],pthreads:{},init(){d||u.initMainThread()},initMainThread(){for(var e=8;e--;)u.allocateUnusedWorker();He(async()=>{var r=u.loadWasmModuleToAllWorkers();Wr(),await r,Rr()})},terminateAllThreads:()=>{for(var e of u.runningWorkers)Ue(e);for(var e of u.unusedWorkers)Ue(e);u.unusedWorkers=[],u.runningWorkers=[],u.pthreads={}},returnWorkerToPool:e=>{var r=e.pthread_ptr;delete u.pthreads[r],u.unusedWorkers.push(e),u.runningWorkers.splice(u.runningWorkers.indexOf(e),1),e.pthread_ptr=0,fr(r)},threadInitTLS(){u.tlsInitFunctions.forEach(e=>e())},loadWasmModuleToWorker:e=>new Promise(r=>{e.onmessage=o=>{var i=o.data,l=i.cmd;if(i.targetThread&&i.targetThread!=te()){var v=u.pthreads[i.targetThread];v?v.postMessage(i,i.transferList):m(`Internal error! Worker sent a message "${l}" to target pthread ${i.targetThread}, but that thread no longer exists!`);return}l==="checkMailbox"?ee():l==="spawnThread"?Be(i):l==="cleanupThread"?Ye(()=>Ie(i.thread)):l==="loaded"?(e.loaded=!0,r(e)):i.target==="setimmediate"?e.postMessage(i):l==="callHandler"?n[i.handler](...i.args):l&&m(`worker sent an unknown command ${l}`)},e.onerror=o=>{var i="worker sent an error!";throw m(`${i} ${o.filename}:${o.lineno}: ${o.message}`),o};var t=[],a=["onExit","onAbort","print","printErr"];for(var s of a)n.propertyIsEnumerable(s)&&t.push(s);e.postMessage({cmd:"load",handlers:t,wasmMemory:M,wasmModule:W})}),async loadWasmModuleToAllWorkers(){return d?void 0:Promise.all(u.unusedWorkers.map(u.loadWasmModuleToWorker))},allocateUnusedWorker(){var e;if(n.mainScriptUrlOrBlob){var r=n.mainScriptUrlOrBlob;typeof r!="string"&&(r=URL.createObjectURL(r)),e=new Worker(r,{type:"module",name:"em-pthread"})}else e=new Worker(new URL("/Img2Num/assets/index-CRSnZN8E.js",self.location.href),{type:"module",name:"em-pthread"});u.unusedWorkers.push(e)},getNewWorker(){return u.unusedWorkers.length==0&&(u.allocateUnusedWorker(),u.loadWasmModuleToWorker(u.unusedWorkers[0])),u.unusedWorkers.pop()}},Oe=[],Sr=e=>Oe.push(e);function Pr(e){var r=(f(),_)[e+52>>2],t=(f(),_)[e+56>>2],a=r-t;ur(r,a),ve(r)}function Ur(e,r="i8"){switch(r.endsWith("*")&&(r="*"),r){case"i1":return(f(),T)[e];case"i8":return(f(),T)[e];case"i16":return(f(),oe)[e>>1];case"i32":return(f(),L)[e>>2];case"i64":return(f(),E)[e>>3];case"float":return(f(),fe)[e>>2];case"double":return(f(),K)[e>>3];case"*":return(f(),_)[e>>2];default:q(`invalid type for getValue: ${r}`)}}var je=[],Ve,Ir=e=>{var r=je[e];return r||(je[e]=r=Ve.get(e)),r},Fr=(e,r)=>{ce=0,me=0;var t=Ir(e)(r);function a(s){if(J()){B=s;return}we(s)}a(t)},me=!1,Nr=e=>u.tlsInitFunctions.push(e);function Hr(e,r,t="i8"){switch(t.endsWith("*")&&(t="*"),t){case"i1":(f(),T)[e]=r;break;case"i8":(f(),T)[e]=r;break;case"i16":(f(),oe)[e>>1]=r;break;case"i32":(f(),L)[e>>2]=r;break;case"i64":(f(),E)[e>>3]=BigInt(r);break;case"float":(f(),fe)[e>>2]=r;break;case"double":(f(),K)[e>>3]=r;break;case"*":(f(),_)[e>>2]=r;break;default:q(`invalid type for setValue: ${t}`)}}class Br{constructor(r){this.excPtr=r,this.ptr=r-24}set_type(r){(f(),_)[this.ptr+4>>2]=r}get_type(){return(f(),_)[this.ptr+4>>2]}set_destructor(r){(f(),_)[this.ptr+8>>2]=r}get_destructor(){return(f(),_)[this.ptr+8>>2]}set_caught(r){r=r?1:0,(f(),T)[this.ptr+12]=r}get_caught(){return(f(),T)[this.ptr+12]!=0}set_rethrown(r){r=r?1:0,(f(),T)[this.ptr+13]=r}get_rethrown(){return(f(),T)[this.ptr+13]!=0}init(r,t){this.set_adjusted_ptr(0),this.set_type(r),this.set_destructor(t)}set_adjusted_ptr(r){(f(),_)[this.ptr+16>>2]=r}get_adjusted_ptr(){return(f(),_)[this.ptr+16>>2]}}var xe=0,Cr=(e,r,t)=>{var a=new Br(e);throw a.init(r,t),xe=e,xe};function ze(e,r,t,a){return d?$(2,0,1,e,r,t,a):Ke(e,r,t,a)}var Lr=()=>typeof SharedArrayBuffer<"u",Ke=(e,r,t,a)=>{if(!Lr())return 6;var s=[],o=0;if(d&&(s.length===0||o))return ze(e,r,t,a);var i={startRoutine:t,pthread_ptr:e,arg:a,transferList:s};return d?(i.cmd="spawnThread",postMessage(i,s),0):Be(i)},$r=()=>q(""),Or=e=>{be(e,!R,1,!F,65536,!1),u.threadInitTLS()},De=e=>{if(e instanceof Pe||e=="unwind")return B;k(1,e)},jr=()=>{if(!le&&!J())try{if(d){te()&&we(B);return}he(B)}catch(e){De(e)}},Ye=e=>{if(!(le||X))try{e(),jr()}catch(r){De(r)}},_e=e=>{if(typeof Atomics.waitAsync=="function"){var r=Atomics.waitAsync((f(),L),e>>2,e);r.value.then(ee);var t=e+128;Atomics.store((f(),L),t>>2,1)}},ee=()=>Ye(()=>{var e=te();e&&(_e(e),lr())}),Vr=(e,r)=>{if(e==r)setTimeout(ee);else if(d)postMessage({targetThread:e,cmd:"checkMailbox"});else{var t=u.pthreads[e];if(!t)return;t.postMessage({cmd:"checkMailbox"})}},re=[],xr=(e,r,t,a,s)=>{a/=2,re.length=a;for(var o=s>>3,i=0;i<a;i++)(f(),E)[o+2*i]?re[i]=(f(),E)[o+2*i+1]:re[i]=(f(),K)[o+2*i+1];var l=ut[e];u.currentProxiedOperationCallerThread=t;var v=l(...re);return u.currentProxiedOperationCallerThread=0,v},zr=e=>{d?postMessage({cmd:"cleanupThread",thread:e}):Ie(e)},Kr=e=>{},Dr=(e,r,t,a)=>{if(!(a>0))return 0;for(var s=t,o=t+a-1,i=0;i<e.length;++i){var l=e.codePointAt(i);if(l<=127){if(t>=o)break;r[t++]=l}else if(l<=2047){if(t+1>=o)break;r[t++]=192|l>>6,r[t++]=128|l&63}else if(l<=65535){if(t+2>=o)break;r[t++]=224|l>>12,r[t++]=128|l>>6&63,r[t++]=128|l&63}else{if(t+3>=o)break;r[t++]=240|l>>18,r[t++]=128|l>>12&63,r[t++]=128|l>>6&63,r[t++]=128|l&63,i++}}return r[t]=0,t-s},O=(e,r,t)=>Dr(e,(f(),C),r,t),Yr=(e,r,t,a)=>{var s=new Date().getFullYear(),o=new Date(s,0,1),i=new Date(s,6,1),l=o.getTimezoneOffset(),v=i.getTimezoneOffset(),g=Math.max(l,v);(f(),_)[e>>2]=g*60,(f(),L)[r>>2]=+(l!=v);var b=ae=>{var y=ae>=0?"-":"+",S=Math.abs(ae),dt=String(Math.floor(S/60)).padStart(2,"0"),ht=String(S%60).padStart(2,"0");return`UTC${y}${dt}${ht}`},G=b(l),j=b(v);v<l?(O(G,t,17),O(j,a,17)):(O(G,a,17),O(j,t,17))},Gr=()=>performance.timeOrigin+performance.now(),Qr=()=>{},Xr=()=>{ce+=1},Zr=()=>{throw Xr(),"unwind"},qr=()=>2147483648,Jr=(e,r)=>Math.ceil(e/r)*r,et=e=>{var r=M.buffer.byteLength,t=(e-r+65535)/65536|0;try{return M.grow(t),Z(),1}catch{}},rt=e=>{var r=(f(),C).length;if(e>>>=0,e<=r)return!1;var t=qr();if(e>t)return!1;for(var a=1;a<=4;a*=2){var s=r*(1+.2/a);s=Math.min(s,e+100663296);var o=Math.min(t,Jr(Math.max(e,s),65536)),i=et(o);if(i)return!0}return!1},pe={},tt=()=>N||"./this.program",Y=()=>{if(!Y.strings){var e=(typeof navigator=="object"&&navigator.language||"C").replace("-","_")+".UTF-8",r={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:e,_:tt()};for(var t in pe)pe[t]===void 0?delete r[t]:r[t]=pe[t];var a=[];for(var t in r)a.push(`${t}=${r[t]}`);Y.strings=a}return Y.strings};function Ge(e,r){if(d)return $(3,0,1,e,r);var t=0,a=0;for(var s of Y()){var o=r+t;(f(),_)[e+a>>2]=o,t+=O(s,o,1/0)+1,a+=4}return 0}var Qe=e=>{for(var r=0,t=0;t<e.length;++t){var a=e.charCodeAt(t);a<=127?r++:a<=2047?r+=2:a>=55296&&a<=57343?(r+=4,++t):r+=3}return r};function Xe(e,r){if(d)return $(4,0,1,e,r);var t=Y();(f(),_)[e>>2]=t.length;var a=0;for(var s of t)a+=Qe(s)+1;return(f(),_)[r>>2]=a,0}var ge=[null,[],[]],Ze=typeof TextDecoder<"u"?new TextDecoder:void 0,nt=(e,r,t,a)=>{var s=r+t;if(a)return s;for(;e[r]&&!(r>=s);)++r;return r},qe=(e,r=0,t,a)=>{var s=nt(e,r,t,a);if(s-r>16&&e.buffer&&Ze)return Ze.decode(e.buffer instanceof ArrayBuffer?e.subarray(r,s):e.slice(r,s));for(var o="";r<s;){var i=e[r++];if(!(i&128)){o+=String.fromCharCode(i);continue}var l=e[r++]&63;if((i&224)==192){o+=String.fromCharCode((i&31)<<6|l);continue}var v=e[r++]&63;if((i&240)==224?i=(i&15)<<12|l<<6|v:i=(i&7)<<18|l<<12|v<<6|e[r++]&63,i<65536)o+=String.fromCharCode(i);else{var g=i-65536;o+=String.fromCharCode(55296|g>>10,56320|g&1023)}}return o},ye=(e,r)=>{var t=ge[e];r===0||r===10?((e===1?A:m)(qe(t)),t.length=0):t.push(r)},at=()=>{sr(0),ge[1].length&&ye(1,10),ge[2].length&&ye(2,10)},Je=(e,r,t)=>e?qe((f(),C),e,r,t):"";function er(e,r,t,a){if(d)return $(5,0,1,e,r,t,a);for(var s=0,o=0;o<t;o++){var i=(f(),_)[r>>2],l=(f(),_)[r+4>>2];r+=8;for(var v=0;v<l;v++)ye(e,(f(),C)[i+v]);s+=l}return(f(),_)[a>>2]=s,0}var it=()=>e=>e.set(crypto.getRandomValues(new Uint8Array(e.byteLength))),rr=e=>{(rr=it())(e)},st=(e,r)=>(rr((f(),C).subarray(e,e+r)),0),tr=e=>{var r=n["_"+e];return r},ot=(e,r)=>{(f(),T).set(e,r)},ft=e=>{var r=Qe(e)+1,t=de(r);return O(e,t,r),t},nr=(e,r,t,a,s)=>{var o={string:y=>{var S=0;return y!=null&&y!==0&&(S=ft(y)),S},array:y=>{var S=de(y.length);return ot(y,S),S}};function i(y){return r==="string"?Je(y):r==="boolean"?!!y:y}var l=tr(e),v=[],g=0;if(a)for(var b=0;b<a.length;b++){var G=o[t[b]];G?(g===0&&(g=Ce()),v[b]=G(a[b])):v[b]=a[b]}var j=l(...v);function ae(y){return g!==0&&ve(g),i(y)}return j=ae(j),j},lt=(e,r,t,a)=>{var s=!t||t.every(i=>i==="number"||i==="boolean"),o=r!=="string";return o&&s&&!a?tr(e):(...i)=>nr(e,r,t,i)};if(u.init(),pr(),n.noExitRuntime&&(me=n.noExitRuntime),n.print&&(A=n.print),n.printErr&&(m=n.printErr),n.wasmBinary&&(w=n.wasmBinary),n.arguments&&n.arguments,n.thisProgram&&(N=n.thisProgram),n.preInit)for(typeof n.preInit=="function"&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.shift()();n.ccall=nr,n.cwrap=lt,n.setValue=Hr,n.getValue=Ur,n.UTF8ToString=Je;var ut=[Le,$e,ze,Ge,Xe,er],te,ar,be,ir,sr,or,fr,we,lr,ur,cr,vr,dr;function ct(e){n._bilateral_filter=e.w,n._gaussian_blur_fft=e.x,n._invert_image=e.y,n._threshold_image=e.z,n._black_threshold_image=e.A,n._kmeans=e.B,n._labels_to_svg=e.C,n._malloc=e.D,e.E,te=e.F,ar=e.G,be=e.H,ir=e.I,sr=e.J,n._free=e.K,or=e.L,fr=e.M,we=e.N,lr=e.O,ur=e.P,cr=e.Q,vr=e.R,dr=e.S}var hr;function vt(){hr={b:Cr,g:Ke,q:$r,j:Or,s:Vr,h:xr,d:zr,i:_e,l:Kr,n:Yr,e:Qr,k:Zr,c:Gr,r:rt,o:Ge,p:Xe,t:he,f:er,a:M,m:st}}function ne(){if(P>0){D=ne;return}if(d){ie?.(n),We();return}if(gr(),P>0){D=ne;return}function e(){n.calledRun=!0,!X&&(We(),ie?.(n),n.onRuntimeInitialized?.(),br())}n.setStatus?(n.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>n.setStatus(""),1),e()},1)):e()}var U;return d||(U=await Se(),ne()),Re?h=n:h=new Promise((e,r)=>{ie=e,Ae=r}),h}var mr=globalThis.self?.name?.startsWith("em-pthread");mr&&Te();let p,ke;const _r=new Promise(c=>ke=c);Te().then(c=>{p=c,ke()});const I={void:{},Int32Array:{alloc:c=>{const h=p._malloc(c.byteLength);return p.HEAP32.set(c,h/4),h},read:(c,h)=>new Int32Array(p.HEAP32.buffer,c,h).slice()},Uint8Array:{alloc:c=>{const h=p._malloc(c.byteLength);return p.HEAPU8.set(c,h),h},read:(c,h)=>new Uint8Array(p.HEAPU8.subarray(c,c+h)).slice()},Uint8ClampedArray:{alloc:c=>{const h=p._malloc(c.byteLength);return p.HEAPU8.set(c,h),h},read:(c,h)=>new Uint8ClampedArray(p.HEAPU8.subarray(c,c+h)).slice()},string:{alloc:c=>{const h=p.lengthBytesUTF8(c)+1,n=p._malloc(h);return p.stringToUTF8(c,n,h),n},read:c=>c?p.UTF8ToString(c):null}};self.onmessage=async({data:c})=>{await _r;const{id:h,funcName:n,args:F=void 0,bufferKeys:R=void 0,returnType:d="void"}=c;if(R?.length&&!F)throw new Error(`WASM call "${n}" has bufferKeys defined but no args object provided. Each bufferKey must correspond to a key in args.`);const N=new Map;try{const k=new Map(F?Object.entries(F):[]);R?.forEach(({key:A,type:m})=>{if(!(m in I))throw new Error(`Unsupported type: ${m}`);const w=k.get(A),W=I[m].alloc(w);N.set(A,{ptr:W,type:m,length:w?.length}),k.set(A,W)});const V=`_${n}`;if(typeof p[V]!="function")throw new Error(`Export not found: ${V}`);const H=p[V](...k.values()),Q=new Map;R?.forEach(({key:A,type:m})=>{const w=N.get(A);Q.set(A,I[m].read(w.ptr,w.length))});let x=H;d&&I[d]!==I.void&&(x=I[d].read(H));const z=Object.fromEntries(Q);self.postMessage({id:h,output:z,returnValue:x})}catch(k){self.postMessage({id:h,error:k.message})}finally{for(const{ptr:k}of N.values())p._free(k)}}})();
