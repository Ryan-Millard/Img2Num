(function(){"use strict";async function re(h={}){var P,t=h,U=self.location.href,d="";function B(e){return t.locateFile?t.locateFile(e,d):d+e}var g;{try{d=new URL(".",U).href}catch{}g=async e=>{var r=await fetch(e,{credentials:"same-origin"});if(r.ok)return r.arrayBuffer();throw new Error(r.status+" : "+r.url)}}console.log.bind(console);var w=console.error.bind(console),A,F=!1,p,v,f,l,u,S,W,_,C,H,I,$=!1;function L(){var e=f.buffer;l=new Int8Array(e),S=new Int16Array(e),t.HEAPU8=u=new Uint8Array(e),t.HEAP32=W=new Int32Array(e),_=new Uint32Array(e),C=new Float32Array(e),H=new Float64Array(e),I=new BigInt64Array(e),new BigUint64Array(e)}function ne(){if(t.preRun)for(typeof t.preRun=="function"&&(t.preRun=[t.preRun]);t.preRun.length;)me(t.preRun.shift());z(O)}function ae(){$=!0,E.g()}function ie(){if(t.postRun)for(typeof t.postRun=="function"&&(t.postRun=[t.postRun]);t.postRun.length;)ye(t.postRun.shift());z(D)}function M(e){t.onAbort?.(e),e="Aborted("+e+")",w(e),F=!0,e+=". Build with -sASSERTIONS for more info.";var r=new WebAssembly.RuntimeError(e);throw v?.(r),r}var j;function se(){return t.locateFile?B("index.wasm"):new URL("/Img2Num/assets/index-oUzGjKCw.wasm",self.location.href).href}function oe(e){if(e==j&&A)return new Uint8Array(A);throw"both async and sync fetching of the wasm failed"}async function ce(e){if(!A)try{var r=await g(e);return new Uint8Array(r)}catch{}return oe(e)}async function fe(e,r){try{var n=await ce(e),a=await WebAssembly.instantiate(n,r);return a}catch(o){w(`failed to asynchronously prepare wasm: ${o}`),M(o)}}async function le(e,r,n){if(!e)try{var a=fetch(r,{credentials:"same-origin"}),o=await WebAssembly.instantiateStreaming(a,n);return o}catch(s){w(`wasm streaming compile failed: ${s}`),w("falling back to ArrayBuffer instantiation")}return fe(r,n)}function ue(){return{a:Ve}}async function ve(){function e(s,i){return E=s.exports,f=E.f,L(),Ne(E),E}function r(s){return e(s.instance)}var n=ue();if(t.instantiateWasm)return new Promise((s,i)=>{t.instantiateWasm(n,(c,b)=>{s(e(c))})});j??=se();var a=await le(A,j,n),o=r(a);return o}var z=e=>{for(;e.length>0;)e.shift()(t)},D=[],ye=e=>D.push(e),O=[],me=e=>O.push(e);function ge(e,r="i8"){switch(r.endsWith("*")&&(r="*"),r){case"i1":return l[e];case"i8":return l[e];case"i16":return S[e>>1];case"i32":return W[e>>2];case"i64":return I[e>>3];case"float":return C[e>>2];case"double":return H[e>>3];case"*":return _[e>>2];default:M(`invalid type for getValue: ${r}`)}}function _e(e,r,n="i8"){switch(n.endsWith("*")&&(n="*"),n){case"i1":l[e]=r;break;case"i8":l[e]=r;break;case"i16":S[e>>1]=r;break;case"i32":W[e>>2]=r;break;case"i64":I[e>>3]=BigInt(r);break;case"float":C[e>>2]=r;break;case"double":H[e>>3]=r;break;case"*":_[e>>2]=r;break;default:M(`invalid type for setValue: ${n}`)}}var de=e=>G(e),he=()=>x();class we{constructor(r){this.excPtr=r,this.ptr=r-24}set_type(r){_[this.ptr+4>>2]=r}get_type(){return _[this.ptr+4>>2]}set_destructor(r){_[this.ptr+8>>2]=r}get_destructor(){return _[this.ptr+8>>2]}set_caught(r){r=r?1:0,l[this.ptr+12]=r}get_caught(){return l[this.ptr+12]!=0}set_rethrown(r){r=r?1:0,l[this.ptr+13]=r}get_rethrown(){return l[this.ptr+13]!=0}init(r,n){this.set_adjusted_ptr(0),this.set_type(r),this.set_destructor(n)}set_adjusted_ptr(r){_[this.ptr+16>>2]=r}get_adjusted_ptr(){return _[this.ptr+16>>2]}}var K=0,Ae=(e,r,n)=>{var a=new we(e);throw a.init(r,n),K=e,K},pe=()=>M(""),be=()=>Date.now(),Re=()=>2147483648,ke=(e,r)=>Math.ceil(e/r)*r,Pe=e=>{var r=f.buffer.byteLength,n=(e-r+65535)/65536|0;try{return f.grow(n),L(),1}catch{}},Ue=e=>{var r=u.length;e>>>=0;var n=Re();if(e>n)return!1;for(var a=1;a<=4;a*=2){var o=r*(1+.2/a);o=Math.min(o,e+100663296);var s=Math.min(n,ke(Math.max(e,o),65536)),i=Pe(s);if(i)return!0}return!1},Ee=()=>e=>crypto.getRandomValues(e),Y=e=>{(Y=Ee())(e)},Be=(e,r)=>(Y(u.subarray(e,e+r)),0),J=e=>{var r=t["_"+e];return r},Te=(e,r)=>{l.set(e,r)},Fe=e=>{for(var r=0,n=0;n<e.length;++n){var a=e.charCodeAt(n);a<=127?r++:a<=2047?r+=2:a>=55296&&a<=57343?(r+=4,++n):r+=3}return r},Me=(e,r,n,a)=>{if(!(a>0))return 0;for(var o=n,s=n+a-1,i=0;i<e.length;++i){var c=e.codePointAt(i);if(c<=127){if(n>=s)break;r[n++]=c}else if(c<=2047){if(n+1>=s)break;r[n++]=192|c>>6,r[n++]=128|c&63}else if(c<=65535){if(n+2>=s)break;r[n++]=224|c>>12,r[n++]=128|c>>6&63,r[n++]=128|c&63}else{if(n+3>=s)break;r[n++]=240|c>>18,r[n++]=128|c>>12&63,r[n++]=128|c>>6&63,r[n++]=128|c&63,i++}}return r[n]=0,n-o},Se=(e,r,n)=>Me(e,u,r,n),Q=e=>q(e),We=e=>{var r=Fe(e)+1,n=Q(r);return Se(e,n,r),n},X=typeof TextDecoder<"u"?new TextDecoder:void 0,Ce=(e,r,n,a)=>{for(var o=r+n;e[r]&&!(r>=o);)++r;return r},He=(e,r=0,n,a)=>{var o=Ce(e,r,n);if(o-r>16&&e.buffer&&X)return X.decode(e.subarray(r,o));for(var s="";r<o;){var i=e[r++];if(!(i&128)){s+=String.fromCharCode(i);continue}var c=e[r++]&63;if((i&224)==192){s+=String.fromCharCode((i&31)<<6|c);continue}var b=e[r++]&63;if((i&240)==224?i=(i&15)<<12|c<<6|b:i=(i&7)<<18|c<<12|b<<6|e[r++]&63,i<65536)s+=String.fromCharCode(i);else{var R=i-65536;s+=String.fromCharCode(55296|R>>10,56320|R&1023)}}return s},Ie=(e,r,n)=>e?He(u,e,r):"",Z=(e,r,n,a,o)=>{var s={string:y=>{var T=0;return y!=null&&y!==0&&(T=We(y)),T},array:y=>{var T=Q(y.length);return Te(y,T),T}};function i(y){return r==="string"?Ie(y):r==="boolean"?!!y:y}var c=J(e),b=[],R=0;if(a)for(var k=0;k<a.length;k++){var ee=s[n[k]];ee?(R===0&&(R=he()),b[k]=ee(a[k])):b[k]=a[k]}var N=c(...b);function Le(y){return R!==0&&de(R),i(y)}return N=Le(N),N},je=(e,r,n,a)=>{var o=!n||n.every(i=>i==="number"||i==="boolean"),s=r!=="string";return s&&o&&!a?J(e):(...i)=>Z(e,r,n,i)};if(t.noExitRuntime&&t.noExitRuntime,t.print&&t.print,t.printErr&&(w=t.printErr),t.wasmBinary&&(A=t.wasmBinary),t.arguments&&t.arguments,t.thisProgram&&t.thisProgram,t.preInit)for(typeof t.preInit=="function"&&(t.preInit=[t.preInit]);t.preInit.length>0;)t.preInit.shift()();t.ccall=Z,t.cwrap=je,t.setValue=_e,t.getValue=ge;var G,q,x;function Ne(e){t._bilateral_filter=e.h,t._gaussian_blur_fft=e.i,t._invert_image=e.j,t._threshold_image=e.k,t._black_threshold_image=e.l,t._kmeans=e.m,t._kmeans_clustering_spatial=e.n,t._kmeans_clustering_graph=e.o,t._malloc=e.p,t._free=e.q,G=e.r,q=e.s,x=e.t}var Ve={a:Ae,d:pe,e:be,c:Ue,b:Be};function $e(){ne();function e(){t.calledRun=!0,!F&&(ae(),p?.(t),t.onRuntimeInitialized?.(),ie())}t.setStatus?(t.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>t.setStatus(""),1),e()},1)):e()}var E;return E=await ve(),$e(),$?P=t:P=new Promise((e,r)=>{p=e,v=r}),P}let m,V;const te=new Promise(h=>V=h);re().then(h=>{m=h,V()}),self.onmessage=async({data:h})=>{await te;const{id:P,funcName:t,args:U,bufferKeys:d}=h,B=Object.create(null);try{if(d)for(const v of d){const f=U[v],l=f.byteLength,u=m._malloc(l);if(f instanceof Int32Array)m.HEAP32.set(f,u/Int32Array.BYTES_PER_ELEMENT);else if(f instanceof Uint8ClampedArray||f instanceof Uint8Array)m.HEAPU8.set(f,u);else throw new Error(`Unsupported TypedArray type for key: ${v}
If you added a new data type to useWasmWorker, please make sure to handle its type in wasmWorker`);B[v]={ptr:u,sizeInBytes:l,type:f.constructor},U[v]=u}const g=`_${t}`;if(typeof m[g]!="function")throw new Error(`WASM export not found: ${g}`);const w=m[g],A=t&&U?Object.values(U):[],F=w(...A),p=Object.create(null);if(d)for(const v of d){const{ptr:f,sizeInBytes:l,type:u}=B[v];if(u===Int32Array)p[v]=new Int32Array(m.HEAP32.buffer,f,l/Int32Array.BYTES_PER_ELEMENT).slice();else if(u===Uint8ClampedArray)p[v]=new Uint8ClampedArray(m.HEAPU8.subarray(f,f+l)).slice();else if(u===Uint8Array)p[v]=new Uint8Array(m.HEAPU8.subarray(f,f+l)).slice();else throw new Error(`Unsupported TypedArray type for output key: ${v}
If you added a new data type to useWasmWorker, please make sure to handle its type in wasmWorker`)}self.postMessage({id:P,output:p,returnValue:F})}catch(g){self.postMessage({id:P,error:g.message})}finally{for(const{ptr:g}of Object.values(B))m._free(g)}}})();
