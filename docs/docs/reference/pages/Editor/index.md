---
title: Editor Page
description: Interactive SVG editor page with pan/zoom and a “color reveal” mode for inspecting generated SVG regions.
keywords: [editor, svg, pan, zoom, pinch, pointer events, react-router, Img2Num]
sidebar_label: Editor
---

# Editor Page

The Editor page renders the SVG generated by Img2Num’s processing pipeline and provides:

- Pan + zoom (mouse wheel, drag, pinch)
- A **Color mode** that hides fills until a shape is tapped/clicked
- A **Preview mode** that disables interaction but preserves the current “revealed” state

## Source files

- Page: [`src/pages/Editor/index.jsx`](https://github.com/Ryan-Millard/Img2Num/blob/main/src/pages/Editor/index.jsx)
- Helmet: [`src/pages/Editor/EditorHelmet.jsx`](https://github.com/Ryan-Millard/Img2Num/blob/main/src/pages/Editor/EditorHelmet.jsx)
- Styles: [`src/pages/Editor/Editor.module.css`](https://github.com/Ryan-Millard/Img2Num/blob/main/src/pages/Editor/Editor.module.css)

## Route and data flow

- Route: `/editor` (registered in [`src/App.jsx`](https://github.com/Ryan-Millard/Img2Num/blob/main/src/App.jsx))
- Input: the page expects an SVG **string** passed via React Router navigation state:

```jsx
navigate('/editor', { state: { svg } });
```

That navigation currently happens at the end of the image pipeline in [`src/components/WasmImageProcessor.jsx`](https://github.com/Ryan-Millard/Img2Num/blob/main/src/components/WasmImageProcessor.jsx).

### Empty state (direct navigation)

If the user loads `/editor` directly (no navigation state), `svg` is missing and the page renders a friendly “No SVG data found” message.

## Dependencies

- React: `useRef`, `useState`
- `react-router-dom`: `useLocation` (for `location.state.svg`)
- `html-react-parser`: converts the SVG string into React elements
- `lucide-react`: icons for the mode toggle
- UI components:
  - `GlassCard` (layout container)
  - `GlassSwitch` (mode toggle)
- Internal: `EditorHelmet`

## Rendering structure (mental model)

At a high level:

1. Outer `GlassCard` (page container)
2. Top-right mode switch (`GlassSwitch`)
3. Inner `GlassCard` viewport (captures pointer/wheel events)
4. A transformed wrapper (`div.inner`) that receives `translate + scale`
5. Parsed SVG element tree (`svgElements`)

The transform is applied to the wrapper, not directly to the `<svg>`, so the SVG keeps its natural size and is moved/scaled as a single unit.

## State and refs

### Mode

- `isColorMode` (boolean)
  - `true`: shapes are “hidden” (filled white) until toggled
  - `false`: preview mode; interactivity disabled

### Transform

- `transform = { scale, tx, ty }`
  - `scale` is clamped to `[0.25, 6]`
  - `tx/ty` represent translation in screen pixels

Applied as:

```js
transform: `translate(${tx}px, ${ty}px) scale(${scale})`;
```

### Pointer bookkeeping

The page uses Pointer Events to support mouse, touch, and pen:

- `viewportRef`: element that captures pointer events (`setPointerCapture`)
- `innerRef`: used to find the rendered `<svg>` root for hit-testing
- `activePointersRef`: `Map(pointerId -> {x,y})` for multi-touch (pinch)
- `pointerState`: drag bookkeeping (`dragging`, last coords, “moved” threshold)
- `pinchRef`: stores pinch start metrics and the **content point under the midpoint** to keep pinch behavior stable

## Interaction behavior

### Wheel zoom

- Trigger: `onWheel` on the viewport
- Behavior: adjusts `scale` only (does not currently zoom-to-cursor)
- Uses a fixed step (`1.12`) and clamps the resulting scale.

### Pan (single pointer)

- Trigger: `onPointerDown` + `onPointerMove` with exactly **one** active pointer
- A small movement threshold (~5px) prevents accidental “tap” toggles from turning into pans.
- Translation is updated incrementally: `tx += dx`, `ty += dy`.

### Pinch zoom (two pointers)

- Trigger: two active pointers
- Tracks:
  - Start distance between pointers
  - Start scale/translation
  - The content-space coordinate under the midpoint at the start
- On move: computes `nextScale` from the distance ratio and updates `tx/ty` so the midpoint stays anchored.

This is the key idea:

$$
 \text{nextTx} = m_x - c_x \cdot \text{nextScale},\quad \text{nextTy} = m_y - c_y \cdot \text{nextScale}
$$

where $(m_x, m_y)$ is the midpoint in screen coordinates and $(c_x, c_y)$ is the original content coordinate under that midpoint.

### Tap/click: toggle “original fill”

When the pointer is released:

- If the user **did not drag** and `isColorMode` is enabled:
  1.  Find the nearest shape under the pointer using `document.elementFromPoint(...).closest(SHAPE_SELECTOR)`
  2.  Verify the shape belongs to the SVG rendered in this page
  3.  Toggle `styles.coloredRegion` on that element

The selector currently targets:

```js
const SHAPE_SELECTOR = 'path,rect,circle,polygon,ellipse';
```

## Styling (Editor.module.css)

### Key classes

| Class           | Purpose                                                                           |
| --------------- | --------------------------------------------------------------------------------- |
| `viewport`      | Clipped interaction surface; `touch-action: none` for consistent pointer handling |
| `inner`         | Transform wrapper (`translate + scale`); uses `will-change: transform`            |
| `grabbing`      | Applied during drag to show a grabbing cursor                                     |
| `colorMode`     | Applied on the outer card when color mode is active                               |
| `previewMode`   | Applied on the outer card when preview mode is active                             |
| `coloredRegion` | Toggled on shapes to reveal original fills                                        |

### How “color reveal” works

In color mode, CSS forces the fill to white **unless** the element has `.coloredRegion`:

- `path:not(.coloredRegion)` (and friends) get `fill: white`
- When the user taps/clicks, the page toggles `.coloredRegion` on that SVG element

This approach is intentionally simple:

- The SVG keeps its original `fill` values.
- CSS only overrides fill when the element is _not_ marked as revealed.

### Preview mode

Preview mode disables pointer interaction via:

- `pointer-events: none` on common SVG primitives

That preserves the user’s current reveal state while preventing accidental toggles during inspection.

### Extending shape support

If Img2Num emits additional SVG primitives (for example `line` or `polyline`), you’ll typically need to update:

1. `SHAPE_SELECTOR` in the page component
2. The CSS selectors in `Editor.module.css` for:
   - the “fill white unless revealed” rule
   - hover/interaction styling
   - preview-mode pointer-events disabling

## Helmet and indexing (EditorHelmet.jsx)

The Editor page is treated as **non-indexable** because it’s essentially a workspace view:

- `<meta name="robots" content="noindex, nofollow" />`
- A descriptive `<title>` and `<meta name="description" />`

Note: even with `noindex`, a canonical URL is provided for consistency.

## Practical tips for contributors

- If you change pointer handling, re-check:
  - mouse pan doesn’t toggle shapes
  - tap toggles still work when zoomed/scaled
  - pinch keeps the midpoint anchored
- If you tweak CSS fill behavior, ensure it doesn’t permanently overwrite SVG inline fills (the current approach avoids that).

## Testing

- Page interactions and Helmet metadata are covered in [src/pages/Editor/Editor.test.jsx](../../../../src/pages/Editor/Editor.test.jsx) and [src/pages/Editor/EditorHelmet.test.jsx](../../../../src/pages/Editor/EditorHelmet.test.jsx).
- Additional guidance lives in [docs/docs/reference/pages/Editor/tests.md](./tests).
